{% extends "layouts/default.njk" %}
{% block bodyClass %}page-single{% endblock %}
{% block content %}
<!-- Article Header -->
<article class="single-post">
  <header class="post-header">
    <div class="container container-narrow">
      <nav class="breadcrumb">
        <a href="/">Home</a>
        <span>/</span>
        <a href="/blog">Blog</a>
        {% if post.category %}
          <span>/</span>
          <a href="/blog/category/{{ post.category.slug }}">{{ post.category.name }}</a>
        {% endif %}
      </nav>
      
      {% if post.category %}
        <a href="/blog/category/{{ post.category.slug }}" class="post-category-badge">{{ post.category.name }}</a>
      {% endif %}
      
      <h1>{{ post.title }}</h1>
      
      <div class="post-meta-header">
        <div class="post-author">
          <div class="author-avatar">
            {% if post.author and post.author.avatar %}
              <img src="{{ post.author.avatar }}" alt="{{ post.author.name }}">
            {% else %}
              <span>{{ post.author.name[0] if post.author else 'A' }}</span>
            {% endif %}
          </div>
          <div class="author-info">
            <span class="author-name">{{ post.author.name if post.author else 'Admin' }}</span>
            <span class="post-date">{{ post.publishedAt | date if post.publishedAt else post.createdAt | date }}</span>
          </div>
        </div>
        <div class="post-stats">
          <span class="reading-time">{{ post.content | readingTime }}</span>
          <span class="views">{{ post.views }} views</span>
        </div>
      </div>
    </div>
  </header>

  {% if post.featuredImage %}
  <div class="post-featured-image">
    <div class="container">
      <img src="{{ post.featuredImage }}" alt="{{ post.title }}">
    </div>
  </div>
  {% endif %}

  <!-- Article Content -->
  <div class="post-content">
    <div class="container container-narrow">
      {% if post.excerpt %}
        <p class="post-excerpt">{{ post.excerpt }}</p>
      {% endif %}

      {% if post.content and post.content.blocks %}
        {% for block in post.content.blocks %}
          {% if block.type == 'paragraph' %}
            <p>{{ block.data.text }}</p>
          {% elif block.type == 'heading' %}
            <h{{ block.data.level or 2 }}>{{ block.data.text }}</h{{ block.data.level or 2 }}>
          {% elif block.type == 'image' %}
            <figure>
              <img src="{{ block.data.src }}" alt="{{ block.data.alt or '' }}">
              {% if block.data.caption %}
                <figcaption>{{ block.data.caption }}</figcaption>
              {% endif %}
            </figure>
          {% elif block.type == 'quote' %}
            <blockquote>
              <p>{{ block.data.text }}</p>
              {% if block.data.author %}
                <cite>â€” {{ block.data.author }}</cite>
              {% endif %}
            </blockquote>
          {% elif block.type == 'list' %}
            {% if block.data.style == 'ordered' %}
              <ol>{% for item in block.data.items %}<li>{{ item }}</li>{% endfor %}</ol>
            {% else %}
              <ul>{% for item in block.data.items %}<li>{{ item }}</li>{% endfor %}</ul>
            {% endif %}
          {% elif block.type == 'code' %}
            <pre><code class="language-{{ block.data.language or 'plaintext' }}">{{ block.data.code }}</code></pre>
          {% elif block.type == 'divider' %}
            <hr>
          {% endif %}
        {% endfor %}
      {% endif %}
    </div>
  </div>

  <!-- Tags & Share -->
  <footer class="post-footer">
    <div class="container container-narrow">
      {% if post.tags %}
      <div class="post-tags">
        <strong>Tags:</strong>
        {% for tag in post.tags.split(',') %}
          <a href="/blog?tag={{ tag | trim }}" class="tag">{{ tag | trim }}</a>
        {% endfor %}
      </div>
      {% endif %}

      <div class="post-share">
        <strong>Share:</strong>
        <div class="share-buttons">
          <a href="https://twitter.com/intent/tweet?text={{ post.title }}&url=" target="_blank" class="share-btn twitter" aria-label="Share on Twitter">
            <svg width="20" height="20" fill="currentColor"><path d="M23 3a10.9 10.9 0 01-3.14 1.53 4.48 4.48 0 00-7.86 3v1A10.66 10.66 0 013 4s-4 9 5 13a11.64 11.64 0 01-7 2c9 5 20 0 20-11.5a4.5 4.5 0 00-.08-.83A7.72 7.72 0 0023 3z"/></svg>
          </a>
          <a href="https://www.facebook.com/sharer/sharer.php?u=" target="_blank" class="share-btn facebook" aria-label="Share on Facebook">
            <svg width="20" height="20" fill="currentColor"><path d="M18 2h-3a5 5 0 00-5 5v3H7v4h3v8h4v-8h3l1-4h-4V7a1 1 0 011-1h3z"/></svg>
          </a>
          <a href="https://www.linkedin.com/shareArticle?mini=true&url=" target="_blank" class="share-btn linkedin" aria-label="Share on LinkedIn">
            <svg width="20" height="20" fill="currentColor"><path d="M16 8a6 6 0 016 6v7h-4v-7a2 2 0 00-2-2 2 2 0 00-2 2v7h-4v-7a6 6 0 016-6z"/><rect x="2" y="9" width="4" height="12"/><circle cx="4" cy="4" r="2"/></svg>
          </a>
          <button class="share-btn copy" onclick="navigator.clipboard.writeText(window.location.href)" aria-label="Copy link">
            <svg width="20" height="20" fill="none" stroke="currentColor" stroke-width="2"><path d="M10 13a5 5 0 007.54.54l3-3a5 5 0 00-7.07-7.07l-1.72 1.71"/><path d="M14 11a5 5 0 00-7.54-.54l-3 3a5 5 0 007.07 7.07l1.71-1.71"/></svg>
          </button>
        </div>
      </div>

      <!-- Author Box -->
      <div class="author-box">
        <div class="author-avatar large">
          {% if post.author and post.author.avatar %}
            <img src="{{ post.author.avatar }}" alt="{{ post.author.name }}">
          {% else %}
            <span>{{ post.author.name[0] if post.author else 'A' }}</span>
          {% endif %}
        </div>
        <div class="author-details">
          <h4>Written by {{ post.author.name if post.author else 'Admin' }}</h4>
          <p>Contributing writer at {{ settings.site_name }}. Passionate about design, technology, and creating meaningful content.</p>
        </div>
      </div>
    </div>
  </footer>
</article>

<!-- Related Posts -->
{% if relatedPosts and relatedPosts.length %}
<section class="related-posts">
  <div class="container">
    <div class="section-header">
      <h2>Related Articles</h2>
    </div>
    <div class="blog-grid blog-grid-3">
      {% for item in relatedPosts %}
      <article class="blog-card">
        <a href="/blog/{{ item.slug }}" class="blog-image">
          {% if item.featuredImage %}
            <img src="{{ item.featuredImage }}" alt="{{ item.title }}" loading="lazy">
          {% else %}
            <div class="placeholder-image"></div>
          {% endif %}
        </a>
        <div class="blog-content">
          {% if item.category %}
            <span class="blog-category">{{ item.category.name }}</span>
          {% endif %}
          <h3><a href="/blog/{{ item.slug }}">{{ item.title }}</a></h3>
          <div class="blog-meta">
            <span>{{ item.createdAt | date }}</span>
          </div>
        </div>
      </article>
      {% endfor %}
    </div>
  </div>
</section>
{% endif %}

<!-- Newsletter CTA -->
<section class="newsletter-section compact">
  <div class="container container-narrow">
    <div class="newsletter-box">
      <h3>Enjoyed this article?</h3>
      <p>Subscribe to get more insights delivered to your inbox.</p>
      <form class="newsletter-form-inline">
        <input type="email" placeholder="Enter your email" required>
        <button type="submit" class="btn btn-primary">Subscribe</button>
      </form>
    </div>
  </div>
</section>
{% endblock %}
